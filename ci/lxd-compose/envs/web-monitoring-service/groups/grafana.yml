name: "grafana"
description: "Grafana Service"

connection: "local"

common_profiles:
  - sdpool
  - net-mottainai0

ephemeral: true

hooks:
  - event: post-node-creation
    commands:
      - sleep 1
      - apt-get update && apt-get upgrade -y
      - apt-get install -y jq wget software-properties-common curl
      - curl https://packages.grafana.com/gpg.key | sudo apt-key add -
      - add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
      - apt-get update && apt-get install -y $(echo ${grafana_packages} | jq '.[]' -r)
      - |
        wget -q -O /usr/bin/yq \
        https://github.com/mikefarah/yq/releases/download/${yq_version}/yq_linux_amd64
      - chmod a+x /usr/bin/yq
      - apt-get clean
      - systemctl enable --now grafana-server

nodes:
- name: web-keepaliver-grafana1
  image_source: "ubuntu/20.10"
  image_remote_server: "images"

